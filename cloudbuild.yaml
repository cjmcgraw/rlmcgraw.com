steps:
  - name: 'gcr.io/cloud-builders/docker'
    script: |
      #! /usr/bin/env bash
      set -eux
      tag=$$(xxd -l16 -ps /dev/urandom)
      container=$$(xxd -l16 -ps /dev/urandom)
      docker build -t $${tag} --target production webapp
      docker create -it --name $${container} $${tag}
      mkdir /build
      docker cp $${container}:/build/dist /build/dist
      ls -al /build/dist

artifacts:
  objects:
    location: 'gs://rlmcgraw-webapp-files'
    paths: ['/build/dist']

timeout: 600s
options:
  logging: CLOUD_LOGGING_ONLY
